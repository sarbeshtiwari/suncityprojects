module.exports=[81403,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944);function e(){let a=(0,d.useRouter)(),e=(0,d.useParams)(),f=e.id&&"add"!==e.id,g=e.id,[h,i]=(0,c.useState)(!1),[j,k]=(0,c.useState)(!1),[l,m]=(0,c.useState)(f),[n,o]=(0,c.useState)({image:"",caption:""});(0,c.useEffect)(()=>{f&&g&&(async()=>{try{let b=await fetch(`/api/amenities/${g}`),c=await b.json();c.success?o({image:c.data.image,caption:c.data.caption}):(alert("Failed to fetch amenity data"),a.push("/admin/amenities"))}catch(b){console.error("Error fetching amenity:",b),alert("Error fetching amenity data"),a.push("/admin/amenities")}finally{m(!1)}})()},[f,g,a]);let p=async a=>{k(!0);try{let b=new FormData;b.append("file",a),b.append("folder","amenities");let c=await fetch("/api/upload",{method:"POST",body:b});if(c.ok)return(await c.json()).url;throw Error("Upload failed")}catch(a){return console.error("Upload error:",a),alert("Failed to upload file: "+(a instanceof Error?a.message:"Unknown error")),null}finally{k(!1)}},q=async a=>{let b=a.target.files?.[0];if(!b)return;let c=b.name.toLowerCase().substring(b.name.lastIndexOf("."));if(!(["image/svg+xml","image/webp","image/avif"].includes(b.type)||[".svg",".webp",".avif"].includes(c))){alert("Please select a valid image file (SVG, WebP, or AVIF format only)"),a.target.value="";return}o(a=>({...a,image:"uploading..."}));let d=await p(b);d?o(a=>({...a,image:d})):o(a=>({...a,image:""}))},r=async b=>{if(b.preventDefault(),!n.image)return void alert("Please upload an image before submitting");i(!0);try{let b=f?`/api/amenities/${g}`:"/api/amenities",c=f?"PUT":"POST",d=await fetch(b,{method:c,headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("adminToken")}`},body:JSON.stringify(n)}),e=await d.json();if(e.success)a.push("/admin/amenities");else{let a=e.details?`${e.error}: ${e.details}`:e.error;alert(`Failed to ${f?"update":"create"} amenity: `+a)}}catch(a){console.error("Submit error:",a),alert(`Error ${f?"updating":"creating"} amenity: `+(a instanceof Error?a.message:"Unknown error"))}finally{i(!1)}};return l?(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary border-t-transparent"})}):(0,b.jsxs)("div",{className:"w-100",children:[(0,b.jsxs)("div",{className:"d-flex align-items-center justify-content-between mb-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"h2 fw-bold text-dark mb-1",children:f?"Edit Amenity":"Add New Amenity"}),(0,b.jsx)("p",{className:"text-muted mb-0",children:f?"Update amenity information":"Create a new amenity for your projects"})]}),(0,b.jsx)("button",{type:"button",onClick:()=>a.back(),className:"btn btn-outline-secondary d-inline-flex align-items-center px-3 py-2",children:"â† Back to Amenities"})]}),(0,b.jsxs)("form",{onSubmit:r,className:"w-100",children:[(0,b.jsx)("div",{className:"card shadow-sm mb-4",children:(0,b.jsxs)("div",{className:"card-body p-4",children:[(0,b.jsx)("h2",{className:"h5 fw-semibold text-dark mb-4 border-bottom pb-2",children:"Amenity Information"}),(0,b.jsxs)("div",{className:"row g-3",children:[(0,b.jsxs)("div",{className:"col-lg-6",children:[(0,b.jsx)("label",{className:"form-label small fw-medium text-muted",children:"Amenity Image"}),(0,b.jsx)("input",{type:"file",accept:".svg,.webp,.avif,image/svg+xml,image/webp,image/avif",onChange:q,required:!0,disabled:j,className:"form-control"}),j&&(0,b.jsx)("div",{className:"mt-2 text-sm text-muted",children:"Uploading..."}),n.image&&"uploading..."!==n.image&&(0,b.jsx)("div",{className:"mt-2",children:(0,b.jsx)("img",{src:n.image,alt:"Amenity Preview",className:"rounded",style:{height:"5rem",width:"5rem",objectFit:"cover"}})}),(0,b.jsx)("small",{className:"mt-2 text-xs text-muted",children:"Accepted formats: SVG, WebP, AVIF"}),"uploading..."===n.image&&(0,b.jsx)("div",{className:"mt-2 text-sm text-primary",children:"Uploading file..."})]}),(0,b.jsxs)("div",{className:"col-lg-6",children:[(0,b.jsx)("label",{className:"form-label small fw-medium text-muted",children:"Caption"}),(0,b.jsx)("input",{type:"text",name:"caption",value:n.caption,onChange:a=>{let{name:b,value:c}=a.target;o(a=>({...a,[b]:c}))},required:!0,className:"form-control"})]})]})]})}),(0,b.jsxs)("div",{className:"d-flex justify-content-end gap-3",children:[(0,b.jsx)("button",{type:"button",onClick:()=>a.back(),className:"btn btn-outline-secondary px-4 py-2",children:"Cancel"}),(0,b.jsx)("button",{type:"submit",disabled:h||j,className:"btn btn-primary px-4 py-2",children:h?f?"Updating...":"Creating...":f?"Update Amenity":"Create Amenity"})]})]})]})}a.s(["default",()=>e])}];

//# sourceMappingURL=app_admin_amenities_add_page_tsx_bccb7cf6._.js.map