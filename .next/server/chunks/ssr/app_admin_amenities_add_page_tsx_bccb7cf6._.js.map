{"version":3,"sources":["../../../../app/admin/amenities/add/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useRouter, useParams } from 'next/navigation';\r\n\r\nexport default function AddAmenityPage() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const isEdit = params.id && params.id !== 'add';\r\n  const amenityId = params.id as string;\r\n  \r\n  const [loading, setLoading] = useState(false);\r\n  const [uploadingFile, setUploadingFile] = useState(false);\r\n  const [initialLoading, setInitialLoading] = useState(isEdit);\r\n  \r\n  const [formData, setFormData] = useState({\r\n    image: '',\r\n    caption: ''\r\n  });\r\n\r\n  // Fetch amenity data for edit mode\r\n  useEffect(() => {\r\n    if (isEdit && amenityId) {\r\n      const fetchAmenity = async () => {\r\n        try {\r\n          const response = await fetch(`/api/amenities/${amenityId}`);\r\n          const data = await response.json();\r\n          \r\n          if (data.success) {\r\n            setFormData({\r\n              image: data.data.image,\r\n              caption: data.data.caption\r\n            });\r\n          } else {\r\n            alert('Failed to fetch amenity data');\r\n            router.push('/admin/amenities');\r\n          }\r\n        } catch (error) {\r\n          console.error('Error fetching amenity:', error);\r\n          alert('Error fetching amenity data');\r\n          router.push('/admin/amenities');\r\n        } finally {\r\n          setInitialLoading(false);\r\n        }\r\n      };\r\n      \r\n      fetchAmenity();\r\n    }\r\n  }, [isEdit, amenityId, router]);\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\r\n    const { name, value } = e.target;\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: value\r\n    }));\r\n  };\r\n\r\n  const handleFileUpload = async (file: File) => {\r\n    setUploadingFile(true);\r\n    \r\n    try {\r\n      const formData = new FormData();\r\n      formData.append('file', file);\r\n      formData.append('folder', 'amenities');\r\n\r\n      const response = await fetch('/api/upload', {\r\n        method: 'POST',\r\n        body: formData,\r\n      });\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        return data.url;\r\n      } else {\r\n        throw new Error('Upload failed');\r\n      }\r\n    } catch (error) {\r\n      console.error('Upload error:', error);\r\n      alert('Failed to upload file: ' + (error instanceof Error ? error.message : 'Unknown error'));\r\n      return null;\r\n    } finally {\r\n      setUploadingFile(false);\r\n    }\r\n  };\r\n\r\n  const handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    // Validate file type\r\n    const allowedTypes = ['image/svg+xml', 'image/webp', 'image/avif'];\r\n    const allowedExtensions = ['.svg', '.webp', '.avif'];\r\n    \r\n    const fileExtension = file.name.toLowerCase().substring(file.name.lastIndexOf('.'));\r\n    const isValidType = allowedTypes.includes(file.type) || allowedExtensions.includes(fileExtension);\r\n    \r\n    if (!isValidType) {\r\n      alert('Please select a valid image file (SVG, WebP, or AVIF format only)');\r\n      e.target.value = ''; // Clear the file input\r\n      return;\r\n    }\r\n\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      image: 'uploading...'\r\n    }));\r\n    \r\n    const url = await handleFileUpload(file);\r\n    \r\n    if (url) {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        image: url\r\n      }));\r\n    } else {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        image: ''\r\n      }));\r\n    }\r\n  };\r\n\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!formData.image) {\r\n      alert('Please upload an image before submitting');\r\n      return;\r\n    }\r\n    \r\n    setLoading(true);\r\n    \r\n    try {\r\n      const url = isEdit ? `/api/amenities/${amenityId}` : '/api/amenities';\r\n      const method = isEdit ? 'PUT' : 'POST';\r\n      \r\n      const response = await fetch(url, {\r\n        method,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${localStorage.getItem('adminToken')}`\r\n        },\r\n        body: JSON.stringify(formData)\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (data.success) {\r\n        router.push('/admin/amenities');\r\n      } else {\r\n        const errorMessage = data.details ? `${data.error}: ${data.details}` : data.error;\r\n        alert(`Failed to ${isEdit ? 'update' : 'create'} amenity: ` + errorMessage);\r\n      }\r\n    } catch (error) {\r\n      console.error('Submit error:', error);\r\n      alert(`Error ${isEdit ? 'updating' : 'creating'} amenity: ` + (error instanceof Error ? error.message : 'Unknown error'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (initialLoading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-64\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-4 border-primary border-t-transparent\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"w-100\">\r\n      {/* Header */}\r\n      <div className=\"d-flex align-items-center justify-content-between mb-4\">\r\n        <div>\r\n          <h1 className=\"h2 fw-bold text-dark mb-1\">\r\n            {isEdit ? 'Edit Amenity' : 'Add New Amenity'}\r\n          </h1>\r\n          <p className=\"text-muted mb-0\">\r\n            {isEdit ? 'Update amenity information' : 'Create a new amenity for your projects'}\r\n          </p>\r\n        </div>\r\n        <button\r\n          type=\"button\"\r\n          onClick={() => router.back()}\r\n          className=\"btn btn-outline-secondary d-inline-flex align-items-center px-3 py-2\"\r\n        >\r\n          ‚Üê Back to Amenities\r\n        </button>\r\n      </div>\r\n\r\n      <form onSubmit={handleSubmit} className=\"w-100\">\r\n        {/* Amenity Information */}\r\n        <div className=\"card shadow-sm mb-4\">\r\n          <div className=\"card-body p-4\">\r\n            <h2 className=\"h5 fw-semibold text-dark mb-4 border-bottom pb-2\">Amenity Information</h2>\r\n            <div className=\"row g-3\">\r\n              <div className=\"col-lg-6\">\r\n                <label className=\"form-label small fw-medium text-muted\">Amenity Image</label>\r\n                <input\r\n                  type=\"file\"\r\n                  accept=\".svg,.webp,.avif,image/svg+xml,image/webp,image/avif\"\r\n                  onChange={handleFileChange}\r\n                  required\r\n                  disabled={uploadingFile}\r\n                  className=\"form-control\"\r\n                />\r\n                {uploadingFile && (\r\n                  <div className=\"mt-2 text-sm text-muted\">Uploading...</div>\r\n                )}\r\n                {formData.image && formData.image !== 'uploading...' && (\r\n                  <div className=\"mt-2\">\r\n                    <img src={formData.image} alt=\"Amenity Preview\" className=\"rounded\" style={{height: '5rem', width: '5rem', objectFit: 'cover'}} />\r\n                  </div>\r\n                )}\r\n                <small className=\"mt-2 text-xs text-muted\">\r\n                  Accepted formats: SVG, WebP, AVIF\r\n                </small>\r\n                {formData.image === 'uploading...' && (\r\n                  <div className=\"mt-2 text-sm text-primary\">Uploading file...</div>\r\n                )}\r\n              </div>\r\n              <div className=\"col-lg-6\">\r\n                <label className=\"form-label small fw-medium text-muted\">Caption</label>\r\n                <input\r\n                  type=\"text\"\r\n                  name=\"caption\"\r\n                  value={formData.caption}\r\n                  onChange={handleInputChange}\r\n                  required\r\n                  className=\"form-control\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Submit Button */}\r\n        <div className=\"d-flex justify-content-end gap-3\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => router.back()}\r\n            className=\"btn btn-outline-secondary px-4 py-2\"\r\n          >\r\n            Cancel\r\n          </button>\r\n          <button\r\n            type=\"submit\"\r\n            disabled={loading || uploadingFile}\r\n            className=\"btn btn-primary px-4 py-2\"\r\n          >\r\n            {loading ? (isEdit ? 'Updating...' : 'Creating...') : (isEdit ? 'Update Amenity' : 'Create Amenity')}\r\n          </button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}